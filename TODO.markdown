*   Convert query builder to extension
*   Implement tree update algorithm